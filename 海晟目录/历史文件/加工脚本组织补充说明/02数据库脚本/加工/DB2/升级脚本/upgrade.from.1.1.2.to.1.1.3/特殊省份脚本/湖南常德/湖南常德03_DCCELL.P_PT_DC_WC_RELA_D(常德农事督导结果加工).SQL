--DROP PROCEDURE DCCELL.P_PT_DC_WC_RELA_D;
CREATE PROCEDURE DCCELL.P_PT_DC_WC_RELA_D
BEGIN
  DECLARE V_PROC_NAME            VARCHAR(1000) DEFAULT 'P_PT_DC_WC_RELA_D';--
  DECLARE V_STEP                 VARCHAR(500);--
  DECLARE V_PT_YEAR              INTEGER       DEFAULT 2019;--
  
  DECLARE V_CURRENTTIMESTAMP     TIMESTAMP;--

  DECLARE V_LOG_GROUP            VARCHAR(32);--
  DECLARE V_LAST_STEP            VARCHAR(32);--
  DECLARE V_LOG                  VARCHAR(32);--

  SET V_CURRENTTIMESTAMP = CURRENT TIMESTAMP;--
  SET V_LOG = ' ';--
  SET V_LOG_GROUP = TO_CHAR(V_CURRENTTIMESTAMP,'YYYY-MM-DD HH24:MI:SS');--


  SELECT BUSI_YEAR INTO V_PT_YEAR
    FROM DC_PROC_BUSI_YEAR A
   WHERE A.PROC_NAME = 'P_DC_CALL_ID_02_SC'
  ;--


 SET V_STEP = '1、R_PT_DC_WC_RELA_D';--
  CALL P_DEBUG_LOG(V_LOG_GROUP,V_PROC_NAME,V_PROC_NAME,V_STEP,TO_CHAR(CURRENT TIMESTAMP,'YYYY-MM-DD HH24:MI:SS')||V_LOG);--
  DELETE FROM R_PT_DC_WC_RELA_D T
   WHERE BUSINESS_YEAR >= V_PT_YEAR
  ;--
  COMMIT;
  
  --1.翻耕督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_A A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000001' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000001' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;
	
	--2.移栽督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000002' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000002' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;
	
	--3.起垄督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_C A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000003' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000004' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;
	
	--4.施肥督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000004' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000005' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;
	
	 --5.覆膜督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000005' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000007' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR; 
    
  --6.大培土督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_E A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000006' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000009' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR; 
    
    
  --7.小培土督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_F A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000007' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000011' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR; 
    
    
  --8.优化结构督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_G A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000008' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000013' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR; 
    
    
  --9.打顶抹杈督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000009' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000015' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR; 
        

  --10.植保督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000010' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000017' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;   
    
  --11.成熟采收督导结果
  INSERT INTO R_PT_DC_WC_RELA_D(
    RELA_D_ID,
    BUSINESS_YEAR,
    STAGE_NAME,
    FARMER_ID,
    FARMER_CD,
    FARMER_NAME,
    DC_CLT_OBJ_ID,
    DC_CLT_OBJ_CD,
    DC_CLT_OBJ_NAME,
    TECHNICIAN_ID,
    TECHNICIAN_NAME,
    BUSINESS_DATE,
    WC_DATE,
    WC_ORG_CD,
    WC_ORG_NAME,
    WC_PSN_ID,
    WC_PSN_NAME,
    WC_PROBLEM,
    WC_IMPORVE_METHOD,
    ORG_CD,
    ORG_NAME,
    AREA_CD,
    AREA_NAME )
  SELECT A.DATA_STORE_BASE_TBL_ID AS RELA_D_ID,
      A.PT_YEAR AS BUSINESS_YEAR,
      C.BILL_NAME AS STAGE_NAME,
      A.RELA_OBJECT_ID AS FARMER_ID,
      A.RELA_OBJECT_CD AS FARMER_CD,
      A.RELA_OBJECT_NAME AS FARMER_NAME,
      A.CLT_OBJ_ID AS DC_CLT_OBJ_ID,
      A.CLT_OBJ_CD AS DC_CLT_OBJ_CD,
      A.CLT_OBJ_NAME AS DC_CLT_OBJ_NAME,
      A.FEEDBACK_PSN_ID AS TECHINICIAN_ID,
      TECH.TECHNICIAN_NAME,
      A.FEEDBACK_DATE AS BUSINESS_DATE,
      B.FEEDBACK_DATE AS WC_DATE,
      ORG.ORG_CD,
      ORG.ORG_NAME,
      B.FEEDBACK_PSN_ID AS WC_PSN_ID,
      STAFF.PSN_NAME AS WC_PSN_NAME,
      B.C1 AS WC_PROBLEM,
      B.C2 AS WC_IMPORVE_METHOD,
      FARMER.ORG_CD,
      FARMER.ORG_NAME,
      FARMER.AREA_CD,
      FARMER.AREA_NAME
    FROM PT_DC_STAT_DATA_B A 
    LEFT JOIN PT_WC_STAT_DATA_A B ON A.CLT_OBJ_ID = B.CLT_OBJ_ID AND A.PT_YEAR=B.PT_YEAR AND B.BILL_NO ='TA19430700000011' AND B.DATA_STATE='1'
    LEFT JOIN PT_DS_BILL_SET_MAS C ON A.BILL_NO = C.BILL_NO AND C.DATA_STATE='1' AND C.PT_YEAR =A.PT_YEAR
    LEFT JOIN R_TECHNICIAN TECH ON A.FEEDBACK_PSN_ID = TECH.TECHNICIAN_ID AND A.PT_YEAR = TECH.BUSINESS_YEAR
    LEFT JOIN CM_OM_STAFF STAFF ON B.FEEDBACK_PSN_ID = STAFF.STAFF_ID  AND STAFF.DATA_STATE='1'
    LEFT JOIN B_ORG ORG ON B.ORG_UNIQUE_CD = ORG.DATA_ORG_CD AND ORG.DATA_STATE='0'
    LEFT JOIN R_FARMER FARMER ON A.CLT_OBJ_ID = FARMER.FARMER_ID AND FARMER.BUSINESS_YEAR=A.PT_YEAR AND FARMER.DATA_STATE='1'
    WHERE  A.BILL_NO = 'TJHNCD0000000020' AND A.DATA_STATE='1' AND A.PT_YEAR=V_PT_YEAR;   
    
    
      MERGE INTO R_PT_DC_WC_RELA_D A
  USING
  (
    SELECT CASE WHEN B.PROV = '0' THEN NULL ELSE B.PROV END AS PROV,
           CASE WHEN B.CITC = '0' THEN NULL ELSE B.CITC END AS CITC,
           CASE WHEN B.COUC = '0' THEN NULL ELSE B.COUC END AS COUC,
           CASE WHEN B.STAC = '0' THEN NULL ELSE B.STAC END AS STAC,
           CASE WHEN B.SSTC = '0' THEN NULL ELSE B.SSTC END AS SSTC,
           CASE WHEN B.SLIN = '0' THEN NULL ELSE B.SLIN END AS SLIN,
           B.PROV_NAME,
           B.CITC_NAME,
           B.COUC_NAME,
           B.STAC_NAME,
           B.SSTC_NAME,
           B.SLIN_NAME,
           B.ORG_UNIQUE_CD,
           B.ORG_NAME
      FROM B_ORG B
     WHERE B.ORG_TYPE = '2'
  ) B
  ON (B.ORG_UNIQUE_CD = A.ORG_CD AND A.DATA_STATE = '1'  AND A.BUSINESS_YEAR >= V_PT_YEAR AND A.PROV_NAME IS NULL)
  WHEN MATCHED THEN
    UPDATE SET
           A.PROV       = B.PROV      ,
           A.CITC       = B.CITC      ,
           A.COUC       = B.COUC      ,
           A.STAC       = B.STAC      ,
           A.SSTC       = B.SSTC      ,
           A.SLIN       = B.SLIN      ,
           A.PROV_NAME  = B.PROV_NAME ,
           A.CITC_NAME  = B.CITC_NAME ,
           A.COUC_NAME  = B.COUC_NAME ,
           A.STAC_NAME  = B.STAC_NAME ,
           A.SSTC_NAME  = B.SSTC_NAME ,
           A.SLIN_NAME  = B.SLIN_NAME ,
           A.ORG_NAME   = B.ORG_NAME
  ;--
  COMMIT;--
  call P_DEBUG_LOG(V_LOG_GROUP,V_PROC_NAME,V_PROC_NAME,'DIV',TO_CHAR(CURRENT TIMESTAMP,'YYYY-MM-DD HH24:MI:SS')||V_LOG);--
  MERGE INTO R_PT_DC_WC_RELA_D A
  USING
  (
    SELECT CASE WHEN B.AREA_PROV = '0' THEN NULL ELSE B.AREA_PROV END AS AREA_PROV,
           CASE WHEN B.AREA_CITC = '0' THEN NULL ELSE B.AREA_CITC END AS AREA_CITC,
           CASE WHEN B.AREA_COUC = '0' THEN NULL ELSE B.AREA_COUC END AS AREA_COUC,
           CASE WHEN B.AREA_TOWN = '0' THEN NULL ELSE B.AREA_TOWN END AS AREA_TOWN,
           CASE WHEN B.AREA_VAGE = '0' THEN NULL ELSE B.AREA_VAGE END AS AREA_VAGE,
           CASE WHEN B.AREA_GRUP = '0' THEN NULL ELSE B.AREA_GRUP END AS AREA_GRUP,
           B.AREA_PROV_NAME,
           B.AREA_CITC_NAME,
           B.AREA_COUC_NAME,
           B.TOWN_NAME,
           B.VAGE_NAME,
           B.GRUP_NAME,
           B.DIVISION_UNIQUE_CD,
           B.ORG_NAME
      FROM B_DIVISION B
  ) B
  ON (B.DIVISION_UNIQUE_CD = A.AREA_CD AND A.DATA_STATE = '1' AND A.BUSINESS_YEAR >= V_PT_YEAR AND A.AREA_PROV_NAME IS NULL)
  WHEN MATCHED THEN
    UPDATE SET
           A.AREA_PROV      = B.AREA_PROV     ,
           A.AREA_CITC      = B.AREA_CITC     ,
           A.AREA_COUC      = B.AREA_COUC     ,
           A.AREA_TOWN      = B.AREA_TOWN     ,
           A.AREA_VAGE      = B.AREA_VAGE     ,
           A.AREA_GRUP      = B.AREA_GRUP     ,
           A.AREA_PROV_NAME = B.AREA_PROV_NAME,
           A.AREA_CITC_NAME = B.AREA_CITC_NAME,
           A.AREA_COUC_NAME = B.AREA_COUC_NAME,
           A.TOWN_NAME      = B.TOWN_NAME     ,
           A.VAGE_NAME      = B.VAGE_NAME     ,
           A.GRUP_NAME      = B.GRUP_NAME     ,
           A.AREA_NAME      = B.ORG_NAME
  ;--
  COMMIT;--    
          
END
@
  